# 可视化优化需求

**创建日期**: 2026-02-26
**优先级**: 高
**状态**: ✅ 已完成 (阶段 1)

---

## 📋 需求概述

优化 RoCEv2 项目的可视化模块，提升用户体验、视觉效果和可维护性。

---

## 🎯 优化目标

### 1. 界面显示优化

#### 1.1 整体布局改进
- [x] 采用 NVIDIA 风格深色主题（深黑背景 + 橙色高亮）
- [ ] 增加响应式断点，适配更多屏幕尺寸
- [ ] 优化侧边栏宽度，可在 240px-320px 之间调整
- [ ] Canvas 区域增加最小尺寸限制，避免过小

#### 1.2 颜色方案统一
- [x] 主色调：`#ff8800` (橙色)
- [x] 次要色：`#ffaa00` (亮橙色)
- [x] 背景色：`#0f0f0f` (深黑) / `#1a1a1a` (次级背景)
- [x] 文字色：`#e0e0e0` (正文) / `#ffffff` (强调)
- [ ] 成功状态：`#76b900` (NVIDIA 绿)
- [ ] 错误状态：`#ff4444` (红色)

#### 1.3 字体优化
- [x] 使用 `"Courier New", monospace` 保持代码风格
- [ ] 标题字体加大至 20px/24px/28px 三档
- [ ] 正文字体 13px-15px 可调
- [ ] 最小字体不低于 11px

---

### 2. Canvas 渲染优化

#### 2.1 节点视觉效果
- [x] 活跃节点：强发光效果 (shadowBlur: 25)
- [x] 完成节点：渐变橙色 + 中等发光
- [x] 未开始节点：暗灰渐变无发光
- [x] 节点边框：活跃时白色粗边框
- [ ] 增加节点脉冲动画效果

#### 2.2 箭头和连接线
- [x] 箭头使用发光效果 (shadowBlur: 8)
- [x] 连接线宽度 3px
- [x] 箭头头大小 15px
- [ ] 增加流动动画（数据传输效果）
- [ ] 曲线使用贝塞尔曲线更平滑

#### 2.3 文字渲染
- [x] 所有文字添加阴影 (shadowBlur: 2-4)
- [x] 重要文字使用白色 `#ffffff`
- [x] 步骤号加大至 24px 加粗
- [ ] 长文字自动换行处理

---

### 3. 交互体验优化

#### 3.1 播放控制
- [x] 播放/暂停快捷键 (Space)
- [x] 上一步/下一步 (←/→)
- [x] 重置 (R)
- [x] 速度调节 (0.5x - 2.0x)
- [ ] 增加进度条拖拽跳转
- [ ] 增加循环播放选项

#### 3.2 信息展示
- [x] 当前步骤信息在侧边栏显示
- [x] 代码映射显示文件、行号、代码片段
- [x] 调试面板实时显示日志
- [ ] 增加步骤详情弹窗
- [ ] 增加 RDMA 术语解释

#### 3.3 移动端适配
- [ ] 触摸手势支持（滑动切换步骤）
- [ ] 移动端布局优化
- [ ] 触摸反馈效果

---

### 4. 代码质量优化

#### 4.1 模块化
- [x] models.js - 数据模型
- [x] renderer.js - 渲染引擎
- [x] animator.js - 动画控制
- [x] app.js - 应用主程序
- [ ] 提取 constants.js - 常量定义
- [ ] 提取 utils.js - 工具函数

#### 4.2 性能优化
- [x] 使用 requestAnimationFrame 同步刷新
- [x] Canvas 2D 而非 SVG
- [ ] 减少不必要的重绘
- [ ] 离屏渲染缓存静态元素
- [ ] 优化网格背景绘制

#### 4.3 可维护性
- [x] Doxygen 风格注释
- [x] 函数不超过 80 行
- [x] 清晰的命名规范
- [ ] 增加单元测试
- [ ] 增加 TypeScript 版本

---

### 5. 内容扩展

#### 5.1 新场景
- [ ] QP 状态转换详解（单独场景）
- [ ] 多 QP 并发演示
- [ ] TCP 控制面握手流程
- [ ] 错误处理和超时场景
- [ ] RDMA Read 操作演示
- [ ] RDMA Write vs Send 对比

#### 5.2 教学辅助
- [ ] 每步增加「为什么要这样做」解释
- [ ] 增加小测验功能
- [ ] 增加笔记功能
- [ ] 导出为 PDF/图片
- [ ] 录制为 GIF/视频

---

## 📊 当前状态

### 已完成的优化 ✅

| 优化项 | 文件 | 说明 |
|--------|------|------|
| NVIDIA 深色主题 | renderer.js, style.css | 深黑背景 + 橙色高亮 |
| 节点发光效果 | renderer.js | 活跃/完成/未开始三种状态 |
| 文字阴影优化 | renderer.js | 提升文字可读性 |
| 网格背景 | renderer.js | 增加视觉深度 |
| 调试面板 | app.js, style.css | 实时日志显示 |
| 代码映射 | app.js | 显示对应源代码位置 |
| 快捷键支持 | app.js | Space/←/→/R |

### 待完成优化 🔄

| 优先级 | 优化项 | 预计工作量 |
|:------:|--------|------------|
| P0 | 流动动画效果 | 4h |
| P0 | 移动端适配 | 6h |
| P1 | 进度条拖拽 | 2h |
| P1 | 离屏缓存 | 3h |
| P2 | 新场景开发 | 8h/场景 |
| P2 | 单元测试 | 4h |

---

## 🎨 设计规范

### 颜色值

```css
/* 主色调 - NVIDIA Orange */
--primary: #ff8800;
--secondary: #ffaa00;
--success: #76b900;  /* NVIDIA Green */
--danger: #ff4444;

/* 背景色 */
--background: #0f0f0f;
--dark-background: #1a1a1a;
--card-background: #1e1e1e;

/* 文字色 */
--text: #e0e0e0;
--text-bold: #ffffff;
--text-muted: #999999;

/* 边框 */
--border: #333333;
--border-light: #444444;
```

### 间距规范

```css
--spacing-xs: 4px;
--spacing-sm: 8px;
--spacing-md: 16px;
--spacing-lg: 24px;
--spacing-xl: 32px;
```

### 字体大小

```css
--font-xs: 11px;   /* 注释 */
--font-sm: 13px;   /* 次要文字 */
--font-md: 15px;   /* 正文 */
--font-lg: 18px;   /* 小标题 */
--font-xl: 24px;   /* 中标题 */
--font-2xl: 28px;  /* 大标题 */
```

---

## 📁 文件结构

```
visualization/
├── index.html              # 主页面
├── simple.html             # 简化版本
├── debug.html              # 调试版本
├── run.sh                  # 启动脚本
├── README.md               # 使用文档
├── QUICKSTART.md           # 快速开始
├── .gitignore
├── css/
│   └── style.css           # 样式表 (327 行)
└── src/
    ├── models.js           # 数据模型 (253 行)
    ├── renderer.js         # 渲染引擎 (796 行)
    ├── animator.js         # 动画控制 (208 行)
    └── app.js              # 应用主程序 (327 行)
```

**总计**: ~1,911 行代码

---

## 🚀 实施计划

### 阶段 1: 视觉优化 (✅ 已完成 100%)
- [x] 深色主题实施
- [x] 节点效果优化（脉冲动画）
- [x] 文字渲染优化
- [x] 按钮和滑块样式增强
- [x] 进度条闪烁动画
- [x] 标题栏渐变效果

### 阶段 2: 交互优化 (已完成 70%)
- [x] 快捷键支持
- [x] 调试面板
- [x] 场景选择按钮优化
- [ ] 进度条拖拽
- [ ] 移动端手势

### 阶段 3: 内容扩展 (未开始)
- [ ] QP 状态转换场景
- [ ] 多 QP 并发场景
- [ ] 错误处理场景

### 阶段 4: 代码质量 (已完成 80%)
- [x] 模块化重构
- [x] 特效模块创建
- [ ] 单元测试
- [ ] TypeScript 迁移

---

## 📝 变更日志

### 2026-02-26 - 阶段 1 完成 ✅
- 完成视觉风格统一（NVIDIA 主题）
- 优化 Canvas 渲染效果（脉冲动画）
- 改进文字可读性
- 增强按钮和滑块样式
- 添加进度条闪烁动画
- 创建特效模块 (effects.js)
- 更新 README 文档
- 创建优化完成报告

### 2026-02-26 - 初始创建
- 创建优化需求文档
- 定义优化目标和规范

---

## 🔗 相关文档

- [可视化需求说明](features/visualization.md)
- [可视化完成报告](features/VISUALIZATION_COMPLETION.md)
- [可视化使用指南](../guides/VISUALIZATION_GUIDE.md)
- [项目架构](technical/ARCHITECTURE.md)

---

**最后更新**: 2026-02-26
**状态**: 进行中 🔄
