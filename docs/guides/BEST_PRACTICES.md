# ✨ 最佳实践

开发工作流、代码审查和常见陷阱避免。

## 🔄 开发工作流

```
1. 需求分析
   ↓
2. 查看相关规范文档
   ↓
3. 编写符合规范的代码
   ↓
4. 遵循代码审查清单
   ↓
5. 编译验证 (make clean && make)
   ↓
6. 功能测试
   ↓
7. 代码审查 (自己审)
   ↓
8. 文档同步
   ↓
9. 提交
```

## ✅ 代码审查清单

编码后检查：
- [ ] 函数不超过80行
- [ ] 参数不超过5个
- [ ] 有Doxygen注释
- [ ] 检查返回值
- [ ] 内存管理正确
- [ ] 错误处理完整
- [ ] 遵守编码规范
- [ ] 无编译警告

提交前检查：
- [ ] `make clean && make` 通过
- [ ] 无编译错误
- [ ] 遵守编码规范
- [ ] 相关文档已更新
- [ ] 测试通过

## ⚠️ 常见陷阱

❌ **不检查malloc返回值**
```c
void *ptr = malloc(size);  // 危险！
```

✅ **正确做法**
```c
void *ptr = malloc(size);
if (ptr == NULL) {
    fprintf(stderr, "malloc failed\n");
    return -ENOMEM;
}
```

---

其他陷阱：
- 跳过QP状态转移步骤
- TCP同步顺序错误
- 接收WR投递顺序错误
- 没有正确关闭socket
- 没有完整清理资源

详见 [编码规范](../../.ai/_conventions.md)
